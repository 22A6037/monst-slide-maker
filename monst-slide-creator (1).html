<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>モンストスライドメーカー</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        :root{--fire:#E53935;--fire-dark:#B71C1C;--water:#1E88E5;--water-dark:#0D47A1;--wood:#43A047;--wood-dark:#1B5E20;--light:#FDD835;--light-dark:#F9A825;--dark:#8E24AA;--dark-dark:#4A148C;--bg-primary:#0a0a0f;--bg-secondary:#12121a;--bg-card:#1a1a25;--text-primary:#fff;--text-secondary:#a0a0b0;--border-color:#2a2a3a}
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Noto Sans JP',sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh}.app-container{display:flex;flex-direction:column;min-height:100vh}
        header{background:linear-gradient(135deg,var(--bg-secondary),var(--bg-primary));padding:1rem 2rem;border-bottom:1px solid var(--border-color);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:1rem}
        .logo{display:flex;align-items:center;gap:.75rem}.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--fire),var(--dark));border-radius:10px;display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:1.5rem}.logo h1{font-size:1.25rem;font-weight:700;background:linear-gradient(90deg,#fff,#a0a0ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .nav-tabs{display:flex;gap:.5rem}.nav-tab{padding:.5rem 1rem;background:transparent;border:1px solid var(--border-color);border-radius:8px;color:var(--text-secondary);cursor:pointer;transition:all .2s;font-family:inherit;font-size:.875rem}.nav-tab:hover{border-color:var(--text-secondary)}.nav-tab.active{background:var(--bg-card);border-color:var(--fire);color:var(--text-primary)}
        main{flex:1;display:flex;gap:1.5rem;padding:1.5rem;overflow:hidden}@media(max-width:1200px){main{flex-direction:column;overflow:auto}}
        .editor-panel{flex:0 0 420px;background:var(--bg-secondary);border-radius:16px;border:1px solid var(--border-color);overflow-y:auto;max-height:calc(100vh - 120px)}@media(max-width:1200px){.editor-panel{flex:none;max-height:none}}
        .editor-section{padding:1.25rem;border-bottom:1px solid var(--border-color)}.editor-section:last-child{border-bottom:none}.section-title{font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--text-secondary);margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}.section-title::before{content:'';width:3px;height:12px;background:var(--fire);border-radius:2px}
        .form-row{display:flex;gap:.75rem;margin-bottom:.75rem}.form-group{flex:1;display:flex;flex-direction:column;gap:.375rem}label{font-size:.75rem;color:var(--text-secondary);font-weight:500}input,select{padding:.625rem .875rem;background:var(--bg-card);border:1px solid var(--border-color);border-radius:8px;color:var(--text-primary);font-family:inherit;font-size:.875rem;transition:border-color .2s}input:focus,select:focus{outline:none;border-color:var(--fire)}select{cursor:pointer}
        .ability-input-group{display:flex;flex-direction:column;gap:.5rem}.ability-row{display:flex;gap:.5rem;align-items:center}.ability-row input{flex:1}.ability-type-badge{font-size:.625rem;padding:.25rem .5rem;border-radius:4px;font-weight:700;min-width:50px;text-align:center}.ability-toggle{font-size:.625rem;padding:.25rem .5rem;border-radius:4px;font-weight:700;min-width:50px;text-align:center;cursor:pointer;border:none;transition:all .2s}.ability-toggle:hover{opacity:.8;transform:scale(1.05)}.badge-ability{background:#2d2d4a;color:#a0a0ff}.badge-gauge{background:#4a2d4a;color:#ffa0ff}.badge-connect{background:#2d4a4a;color:#a0ffff}
        .image-upload-area{border:2px dashed var(--border-color);border-radius:12px;padding:1.5rem;text-align:center;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}.image-upload-area:hover{border-color:var(--fire);background:rgba(229,57,53,.05)}.image-upload-area.has-image{padding:0;border-style:solid}.image-upload-area img{width:100%;height:200px;object-fit:contain;display:block}.upload-placeholder{color:var(--text-secondary);font-size:.875rem}.upload-placeholder svg{width:48px;height:48px;margin-bottom:.5rem;opacity:.5}#imageInput{display:none}
        .image-controls{margin-top:1rem;padding:1rem;background:var(--bg-card);border-radius:12px}.image-controls .form-row{align-items:center;margin-bottom:.5rem}.image-controls input[type="range"]{flex:1;margin-right:.5rem;accent-color:var(--fire)}.image-controls span{min-width:50px;text-align:right;font-size:.75rem;color:var(--text-secondary)}
        .preview-panel{flex:1;display:flex;flex-direction:column;gap:1rem;min-width:0}.preview-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}.preview-title{font-size:1rem;font-weight:600;color:var(--text-secondary)}.action-buttons{display:flex;gap:.5rem}
        .btn{padding:.625rem 1.25rem;border-radius:8px;font-family:inherit;font-size:.875rem;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:.5rem;border:none}.btn-primary{background:linear-gradient(135deg,var(--fire),var(--fire-dark));color:#fff}.btn-primary:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(229,57,53,.4)}.btn-secondary{background:var(--bg-card);color:var(--text-primary);border:1px solid var(--border-color)}.btn-secondary:hover{border-color:var(--text-secondary)}
        .preview-container{flex:1;display:flex;align-items:center;justify-content:center;background:var(--bg-secondary);border-radius:16px;border:1px solid var(--border-color);padding:1.5rem;overflow:auto}.preview-wrapper{width:100%;max-width:960px;transform-origin:top center}
        .slide{width:1920px;height:1080px;position:relative;overflow:hidden;font-family:'Noto Sans JP',sans-serif;transform-origin:top left}.slide-bg{position:absolute;inset:0;background:linear-gradient(135deg,#0a0a12,#1a1a2e 50%,#0a0a12)}.slide-bg::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 20% 80%,var(--accent-color,var(--fire)) 0%,transparent 50%),radial-gradient(circle at 80% 20%,var(--accent-color,var(--fire)) 0%,transparent 50%);opacity:.15}
        .slide-content{position:relative;z-index:1;height:100%;display:grid;grid-template-columns:1fr 1fr;gap:40px;padding:40px 60px}.slide-left{display:flex;flex-direction:column;gap:24px}
        .evolution-badge{display:inline-flex;align-items:center;gap:10px;padding:10px 24px;background:linear-gradient(135deg,var(--accent-color,var(--fire)),var(--accent-dark,var(--fire-dark)));border-radius:50px;font-size:28px;font-weight:900;letter-spacing:.05em;box-shadow:0 8px 32px rgba(0,0,0,.4);width:fit-content}.evolution-badge::before{content:'★';font-size:20px}
        .basic-info-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}.info-card{background:rgba(255,255,255,.05);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:14px 18px;display:flex;flex-direction:column;gap:4px}.info-label{font-size:14px;color:rgba(255,255,255,.5);font-weight:500}.info-value{font-size:28px;font-weight:900;color:#fff}
        .abilities-section{flex:0 0 auto;display:flex;flex-direction:column;gap:10px}.abilities-title{font-size:20px;font-weight:700;color:rgba(255,255,255,.7);display:flex;align-items:center;gap:10px}.abilities-title::before{content:'';width:4px;height:20px;background:var(--accent-color,var(--fire));border-radius:2px}.abilities-list{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
        .ability-tag{padding:10px 18px;border-radius:10px;font-size:22px;font-weight:700;display:flex;align-items:center;gap:8px}.ability-tag.type-ability{background:linear-gradient(135deg,#3d3d6a,#2d2d4a);border:1px solid #5d5d8a}.ability-tag.type-gauge{background:linear-gradient(135deg,#6a3d6a,#4a2d4a);border:1px solid #8a5d8a}.ability-tag.type-gauge::before{content:'G';font-size:14px;padding:3px 6px;background:rgba(255,255,255,.2);border-radius:4px}.ability-tag.type-connect{background:linear-gradient(135deg,#3d6a6a,#2d4a4a);border:1px solid #5d8a8a}.ability-tag.type-connect::before{content:'C';font-size:14px;padding:3px 6px;background:rgba(255,255,255,.2);border-radius:4px}
        .slide-right{display:flex;flex-direction:column;gap:20px;height:100%}.character-image-container{height:500px;flex:0 0 500px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}.character-image-wrapper{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;overflow:hidden}.character-image-wrapper::before{content:'';position:absolute;width:400px;height:400px;background:radial-gradient(circle,var(--accent-color,var(--fire)) 0%,transparent 70%);opacity:.3;border-radius:50%}.character-image{max-width:100%;max-height:100%;object-fit:contain;position:relative;z-index:1;filter:drop-shadow(0 20px 40px rgba(0,0,0,.5))}.no-image-placeholder{width:300px;height:300px;background:rgba(255,255,255,.05);border:2px dashed rgba(255,255,255,.2);border-radius:24px;display:flex;align-items:center;justify-content:center;color:rgba(255,255,255,.3);font-size:20px}
        .skills-section{display:flex;flex-direction:column;gap:12px;flex:0 0 auto}.skill-card{background:rgba(255,255,255,.05);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:16px 22px}.skill-header{display:flex;align-items:center;gap:12px;margin-bottom:8px}.skill-type{font-size:16px;font-weight:700;color:var(--accent-color,var(--fire));padding:5px 14px;background:rgba(255,255,255,.1);border-radius:8px}.skill-turn{font-size:18px;color:rgba(255,255,255,.6);margin-left:auto}.skill-name{font-size:26px;font-weight:900;line-height:1.3}.skill-effect{font-size:24px;color:rgba(255,255,255,.8);margin-top:6px;line-height:1.4;font-weight:700}
        .friendship-section{display:grid;grid-template-columns:1fr 1fr;gap:12px}.friendship-card{background:rgba(255,255,255,.05);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:14px 18px}.friendship-label{font-size:14px;color:rgba(255,255,255,.5);margin-bottom:6px}.friendship-name{font-size:22px;font-weight:700}
        .hidden{display:none!important}.history-panel{display:none;flex:1;background:var(--bg-secondary);border-radius:16px;border:1px solid var(--border-color);overflow:hidden}.history-panel.active{display:flex;flex-direction:column}.history-header{padding:1.25rem;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center}.history-title{font-size:1rem;font-weight:600}.history-list{flex:1;overflow-y:auto;padding:1rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem;align-content:start}.history-item{background:var(--bg-card);border:1px solid var(--border-color);border-radius:12px;overflow:hidden;cursor:pointer;transition:all .2s}.history-item:hover{border-color:var(--fire);transform:translateY(-2px)}.history-thumbnail{width:100%;aspect-ratio:16/9;object-fit:cover;background:var(--bg-primary)}.history-info{padding:.75rem}.history-name{font-size:.875rem;font-weight:600;margin-bottom:.25rem}.history-meta{font-size:.75rem;color:var(--text-secondary);display:flex;justify-content:space-between}.history-actions{display:flex;gap:.5rem;padding:0 .75rem .75rem}.history-btn{flex:1;padding:.5rem;border-radius:6px;font-size:.75rem;font-weight:600;cursor:pointer;border:none;font-family:inherit;transition:all .2s}.history-btn-edit{background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border-color)}.history-btn-delete{background:rgba(229,57,53,.1);color:var(--fire)}.empty-history{text-align:center;color:var(--text-secondary);padding:3rem;grid-column:1/-1}
        @media(max-width:1600px){.slide{transform:scale(.5)}.preview-wrapper{height:540px}}@media(max-width:1200px){.slide{transform:scale(.4)}.preview-wrapper{height:432px}}@media(max-width:768px){header{padding:1rem}main{padding:1rem}.slide{transform:scale(.25)}.preview-wrapper{height:270px}.editor-panel{flex:none}}
        .loading-overlay{position:fixed;inset:0;background:rgba(10,10,15,.9);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;pointer-events:none;transition:opacity .3s}.loading-overlay.active{opacity:1;pointer-events:all}.loading-spinner{width:48px;height:48px;border:3px solid var(--border-color);border-top-color:var(--fire);border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}
        .form-skills-special{background:rgba(229,57,53,.05);border:1px solid rgba(229,57,53,.2);border-radius:12px;padding:1rem;margin-top:.5rem}.special-skills-label{font-size:.75rem;color:var(--fire);font-weight:600;margin-bottom:.75rem;display:flex;align-items:center;gap:.5rem}.special-skill-card{background:rgba(0,0,0,.2);border-radius:12px;padding:14px 18px;margin-bottom:10px}.special-skill-card:last-child{margin-bottom:0}.special-skill-type{font-size:14px;font-weight:700;color:var(--accent-color,var(--fire));margin-bottom:6px}.special-skill-name{font-size:22px;font-weight:700}
    </style>
</head>
<body>
<div class="app-container">
    <header><div class="logo"><div class="logo-icon">M</div><h1>モンストスライドメーカー</h1></div><nav class="nav-tabs"><button class="nav-tab active" data-tab="editor">エディター</button><button class="nav-tab" data-tab="history">作成履歴</button></nav></header>
    <main>
        <div class="editor-panel" id="editorPanel">
            <div class="editor-section"><h3 class="section-title">基本情報</h3><div class="form-row"><div class="form-group"><label for="charName">キャラクター名（管理用）</label><input type="text" id="charName" placeholder="例: ルシファー"></div></div><div class="form-row"><div class="form-group"><label for="evolution">進化形態</label><select id="evolution"><option value="獣神化">獣神化</option><option value="獣神化改">獣神化改</option><option value="真獣神化">真獣神化</option></select></div><div class="form-group"><label for="attribute">属性</label><select id="attribute"><option value="fire">火属性</option><option value="water">水属性</option><option value="wood">木属性</option><option value="light">光属性</option><option value="dark">闇属性</option></select></div></div><div class="form-row"><div class="form-group"><label for="shotType">撃種</label><select id="shotType"><option value="反射">反射</option><option value="貫通">貫通</option></select></div><div class="form-group"><label for="battleType">戦型</label><select id="battleType"><option value="バランス型">バランス型</option><option value="パワー型">パワー型</option><option value="スピード型">スピード型</option><option value="砲撃型">砲撃型</option></select></div></div><div class="form-row"><div class="form-group"><label for="race">種族</label><input type="text" id="race" placeholder="例: 魔族"></div></div></div>
            <div class="editor-section"><h3 class="section-title">アビリティ</h3><div class="ability-input-group"><div class="ability-row"><button type="button" class="ability-toggle badge-ability" data-idx="0" onclick="toggleAb(0)">アビ</button><input type="text" id="ab0" placeholder="アビリティ1"></div><div class="ability-row"><button type="button" class="ability-toggle badge-ability" data-idx="1" onclick="toggleAb(1)">アビ</button><input type="text" id="ab1" placeholder="アビリティ2"></div><div class="ability-row"><button type="button" class="ability-toggle badge-ability" data-idx="2" onclick="toggleAb(2)">アビ</button><input type="text" id="ab2" placeholder="アビリティ3"></div><div class="ability-row"><button type="button" class="ability-toggle badge-ability" data-idx="3" onclick="toggleAb(3)">アビ</button><input type="text" id="ab3" placeholder="アビリティ4"></div><div class="ability-row"><button type="button" class="ability-toggle badge-ability" data-idx="4" onclick="toggleAb(4)">アビ</button><input type="text" id="ab4" placeholder="アビリティ5"></div><div class="ability-row"><button type="button" class="ability-toggle badge-ability" data-idx="5" onclick="toggleAb(5)">アビ</button><input type="text" id="ab5" placeholder="アビリティ6"></div><div class="ability-row"><button type="button" class="ability-toggle badge-ability" data-idx="6" onclick="toggleAb(6)">アビ</button><input type="text" id="ab6" placeholder="アビリティ7"></div><div class="ability-row"><button type="button" class="ability-toggle badge-ability" data-idx="7" onclick="toggleAb(7)">アビ</button><input type="text" id="ab7" placeholder="アビリティ8"></div></div></div>
            <div class="editor-section" id="connectSection"><h3 class="section-title">コネクトスキル（獣神化改のみ）</h3><div class="ability-input-group"><div class="ability-row"><span class="ability-type-badge badge-connect">コネ</span><input type="text" id="connect1" placeholder="コネクトスキル1"></div><div class="ability-row"><span class="ability-type-badge badge-connect">コネ</span><input type="text" id="connect2" placeholder="コネクトスキル2"></div><div class="ability-row"><span class="ability-type-badge badge-connect">コネ</span><input type="text" id="connect3" placeholder="コネクトスキル3"></div></div></div>
            <div class="editor-section" id="specialSkillsSection"><h3 class="section-title">形態固有スキル（真獣神化のみ）</h3><div class="form-skills-special"><div class="special-skills-label"><span>★</span> 真獣神化限定スキル</div><div class="form-group"><label for="shotSkill">ショットスキル</label><input type="text" id="shotSkill" placeholder="例: 弱点ヒットで攻撃力アップ"></div><div class="form-group" style="margin-top:.75rem"><label for="assistSkill">アシストスキル</label><input type="text" id="assistSkill" placeholder="例: 味方の攻撃力アップ"></div></div></div>
            <div class="editor-section"><h3 class="section-title">ストライクショット</h3><div class="form-row"><div class="form-group"><label for="ssName">SS名称</label><input type="text" id="ssName" placeholder="例: 絶対零度の裁き"></div><div class="form-group" style="flex:0 0 100px"><label for="ssTurn">ターン数</label><input type="text" id="ssTurn" placeholder="例: 16"></div></div><div class="form-row"><div class="form-group"><label for="ssEffect">SS効果</label><input type="text" id="ssEffect" placeholder="例: 自強化&敵を貫く分身弾を放つ"></div></div></div>
            <div class="editor-section"><h3 class="section-title">友情コンボ</h3><div class="form-row"><div class="form-group"><label for="friendship">友情コンボ</label><input type="text" id="friendship" placeholder="例: 超強トライデントレーザーEL"></div></div><div class="form-row"><div class="form-group"><label for="subFriendship">副友情コンボ</label><input type="text" id="subFriendship" placeholder="例: 超絶電撃"></div></div></div>
            <div class="editor-section"><h3 class="section-title">キャラクター画像</h3><div class="image-upload-area" id="imageUploadArea"><input type="file" id="imageInput" accept="image/*"><div class="upload-placeholder" id="uploadPlaceholder"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><p>クリックまたはドラッグ&ドロップ</p></div></div><div class="image-controls" id="imageControls" style="display:none"><div class="form-row"><div class="form-group"><label>サイズ</label><input type="range" id="imgScale" min="50" max="200" value="100"><span id="imgScaleVal">100%</span></div></div><div class="form-row"><div class="form-group"><label>横位置</label><input type="range" id="imgX" min="-200" max="200" value="0"><span id="imgXVal">0</span></div></div><div class="form-row"><div class="form-group"><label>縦位置</label><input type="range" id="imgY" min="-200" max="200" value="0"><span id="imgYVal">0</span></div></div><button type="button" class="btn btn-secondary" onclick="resetImg()" style="width:100%;margin-top:.5rem">リセット</button></div></div>
        </div>
        <div class="preview-panel" id="previewPanel">
            <div class="preview-header"><span class="preview-title">プレビュー</span><div class="action-buttons"><button class="btn btn-secondary" id="saveBtn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>保存</button><button class="btn btn-primary" id="exportBtn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>PNG出力</button></div></div>
            <div class="preview-container"><div class="preview-wrapper"><div class="slide" id="slide"><div class="slide-bg"></div><div class="slide-content"><div class="slide-left"><div class="evolution-badge" id="slideEvolution">獣神化</div><div class="basic-info-grid"><div class="info-card"><span class="info-label">属性</span><span class="info-value" id="slideAttribute">火</span></div><div class="info-card"><span class="info-label">撃種</span><span class="info-value" id="slideShotType">反射</span></div><div class="info-card"><span class="info-label">戦型</span><span class="info-value" id="slideBattleType">バランス型</span></div><div class="info-card"><span class="info-label">種族</span><span class="info-value" id="slideRace">魔族</span></div></div><div class="abilities-section"><h4 class="abilities-title">アビリティ</h4><div class="abilities-list" id="slideAbilities"></div></div><div class="special-skills-area" id="slideSpecialSkills" style="display:none"><div class="special-skill-card" id="slideShotSkillCard" style="display:none"><div class="special-skill-type">ショットスキル</div><div class="special-skill-name" id="slideShotSkill"></div></div><div class="special-skill-card" id="slideAssistSkillCard" style="display:none"><div class="special-skill-type">アシストスキル</div><div class="special-skill-name" id="slideAssistSkill"></div></div></div></div><div class="slide-right"><div class="character-image-container"><div class="character-image-wrapper"><div class="no-image-placeholder" id="noImagePlaceholder">画像未設定</div><img class="character-image" id="slideImage" style="display:none"></div></div><div class="skills-section"><div class="skill-card"><div class="skill-header"><span class="skill-type">SS</span><span class="skill-turn" id="slideSSTurn">16ターン</span></div><div class="skill-name" id="slideSSName">ストライクショット名</div><div class="skill-effect" id="slideSSEffect"></div></div><div class="friendship-section"><div class="friendship-card"><div class="friendship-label">友情コンボ</div><div class="friendship-name" id="slideFriendship">友情コンボ名</div></div><div class="friendship-card"><div class="friendship-label">副友情コンボ</div><div class="friendship-name" id="slideSubFriendship">副友情コンボ名</div></div></div></div></div></div></div></div></div>
        </div>
        <div class="history-panel" id="historyPanel"><div class="history-header"><span class="history-title">作成履歴</span><button class="btn btn-secondary" id="clearHistoryBtn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>全削除</button></div><div class="history-list" id="historyList"></div></div>
    </main>
</div>
<div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"></div></div>
<script>
const C={fire:{main:'#E53935',dark:'#B71C1C',name:'火'},water:{main:'#1E88E5',dark:'#0D47A1',name:'水'},wood:{main:'#43A047',dark:'#1B5E20',name:'木'},light:{main:'#FDD835',dark:'#F9A825',name:'光'},dark:{main:'#8E24AA',dark:'#4A148C',name:'闇'}};
const $=id=>document.getElementById(id),el={charName:$('charName'),evolution:$('evolution'),attribute:$('attribute'),shotType:$('shotType'),battleType:$('battleType'),race:$('race'),connect1:$('connect1'),connect2:$('connect2'),connect3:$('connect3'),shotSkill:$('shotSkill'),assistSkill:$('assistSkill'),ssName:$('ssName'),ssTurn:$('ssTurn'),ssEffect:$('ssEffect'),friendship:$('friendship'),subFriendship:$('subFriendship'),imageInput:$('imageInput'),imageUploadArea:$('imageUploadArea'),uploadPlaceholder:$('uploadPlaceholder'),imageControls:$('imageControls'),imgScale:$('imgScale'),imgX:$('imgX'),imgY:$('imgY'),imgScaleVal:$('imgScaleVal'),imgXVal:$('imgXVal'),imgYVal:$('imgYVal'),connectSection:$('connectSection'),specialSkillsSection:$('specialSkillsSection'),slide:$('slide'),slideEvolution:$('slideEvolution'),slideAttribute:$('slideAttribute'),slideShotType:$('slideShotType'),slideBattleType:$('slideBattleType'),slideRace:$('slideRace'),slideAbilities:$('slideAbilities'),slideSpecialSkills:$('slideSpecialSkills'),slideShotSkill:$('slideShotSkill'),slideShotSkillCard:$('slideShotSkillCard'),slideAssistSkill:$('slideAssistSkill'),slideAssistSkillCard:$('slideAssistSkillCard'),slideImage:$('slideImage'),noImagePlaceholder:$('noImagePlaceholder'),slideSSName:$('slideSSName'),slideSSTurn:$('slideSSTurn'),slideSSEffect:$('slideSSEffect'),slideFriendship:$('slideFriendship'),slideSubFriendship:$('slideSubFriendship'),exportBtn:$('exportBtn'),saveBtn:$('saveBtn'),loadingOverlay:$('loadingOverlay'),historyPanel:$('historyPanel'),historyList:$('historyList'),editorPanel:$('editorPanel'),previewPanel:$('previewPanel'),clearHistoryBtn:$('clearHistoryBtn')};
let img=null,editId=null,imgSettings={scale:100,x:0,y:0};
const abTypes=[0,0,0,0,0,0,0,0];
window.toggleAb=idx=>{abTypes[idx]=abTypes[idx]===0?1:0;const btn=document.querySelector(`.ability-toggle[data-idx="${idx}"]`);btn.className=`ability-toggle ${abTypes[idx]===0?'badge-ability':'badge-gauge'}`;btn.textContent=abTypes[idx]===0?'アビ':'ゲージ';upd()};
window.resetImg=()=>{imgSettings={scale:100,x:0,y:0};el.imgScale.value=100;el.imgX.value=0;el.imgY.value=0;el.imgScaleVal.textContent='100%';el.imgXVal.textContent='0';el.imgYVal.textContent='0';upd()};
['charName','evolution','attribute','shotType','battleType','race','connect1','connect2','connect3','shotSkill','assistSkill','ssName','ssTurn','ssEffect','friendship','subFriendship'].forEach(k=>el[k].addEventListener('input',upd));
for(let i=0;i<8;i++)$('ab'+i).addEventListener('input',upd);
el.imgScale.addEventListener('input',()=>{imgSettings.scale=parseInt(el.imgScale.value);el.imgScaleVal.textContent=imgSettings.scale+'%';upd()});
el.imgX.addEventListener('input',()=>{imgSettings.x=parseInt(el.imgX.value);el.imgXVal.textContent=imgSettings.x;upd()});
el.imgY.addEventListener('input',()=>{imgSettings.y=parseInt(el.imgY.value);el.imgYVal.textContent=imgSettings.y;upd()});
el.evolution.addEventListener('change',()=>{vis();upd()});el.attribute.addEventListener('change',upd);
el.imageUploadArea.addEventListener('click',()=>el.imageInput.click());
el.imageInput.addEventListener('change',()=>{const f=el.imageInput.files[0];if(f){const r=new FileReader();r.onload=e=>{img=e.target.result;el.uploadPlaceholder.innerHTML=`<img src="${img}">`;el.imageUploadArea.classList.add('has-image');el.imageControls.style.display='block';upd()};r.readAsDataURL(f)}});
el.imageUploadArea.addEventListener('dragover',e=>{e.preventDefault();el.imageUploadArea.style.borderColor='var(--fire)'});
el.imageUploadArea.addEventListener('dragleave',()=>el.imageUploadArea.style.borderColor='');
el.imageUploadArea.addEventListener('drop',e=>{e.preventDefault();el.imageUploadArea.style.borderColor='';if(e.dataTransfer.files.length){el.imageInput.files=e.dataTransfer.files;el.imageInput.dispatchEvent(new Event('change'))}});
el.exportBtn.addEventListener('click',exp);el.saveBtn.addEventListener('click',save);el.clearHistoryBtn.addEventListener('click',()=>{if(confirm('すべての履歴を削除しますか？')){localStorage.removeItem('monstSlideHistory');hist()}});
document.querySelectorAll('.nav-tab').forEach(t=>t.addEventListener('click',()=>tab(t.dataset.tab)));
function vis(){const e=el.evolution.value;el.connectSection.classList.toggle('hidden',e!=='獣神化改');el.specialSkillsSection.classList.toggle('hidden',e!=='真獣神化')}
function upd(){const a=el.attribute.value,c=C[a],e=el.evolution.value;el.slide.style.setProperty('--accent-color',c.main);el.slide.style.setProperty('--accent-dark',c.dark);el.slideEvolution.textContent=e;el.slideAttribute.textContent=c.name;el.slideShotType.textContent=el.shotType.value;el.slideBattleType.textContent=el.battleType.value;el.slideRace.textContent=el.race.value||'−';
const ab=[];for(let i=0;i<8;i++){const v=$('ab'+i).value;if(v)ab.push({t:abTypes[i]===0?'ability':'gauge',n:v})}if(e==='獣神化改')[el.connect1,el.connect2,el.connect3].forEach(x=>{if(x.value)ab.push({t:'connect',n:x.value})});
el.slideAbilities.innerHTML=ab.map(x=>`<span class="ability-tag type-${x.t}">${x.n}</span>`).join('');
if(e==='真獣神化'){el.slideSpecialSkills.style.display='block';el.slideShotSkillCard.style.display=el.shotSkill.value?'block':'none';el.slideShotSkill.textContent=el.shotSkill.value;el.slideAssistSkillCard.style.display=el.assistSkill.value?'block':'none';el.slideAssistSkill.textContent=el.assistSkill.value}else el.slideSpecialSkills.style.display='none';
if(img){el.slideImage.src=img;el.slideImage.style.display='block';el.slideImage.style.transform=`translate(${imgSettings.x}px,${imgSettings.y}px) scale(${imgSettings.scale/100})`;el.noImagePlaceholder.style.display='none'}else{el.slideImage.style.display='none';el.noImagePlaceholder.style.display='flex'}
el.slideSSName.textContent=el.ssName.value||'ストライクショット名';el.slideSSTurn.textContent=el.ssTurn.value?el.ssTurn.value+'ターン':'';el.slideSSEffect.textContent=el.ssEffect.value||'';el.slideFriendship.textContent=el.friendship.value||'友情コンボ名';el.slideSubFriendship.textContent=el.subFriendship.value||'副友情コンボ名'}
async function exp(){load(1);try{const ot=el.slide.style.transform;el.slide.style.transform='none';const cv=await html2canvas(el.slide,{width:1920,height:1080,scale:1,useCORS:true,allowTaint:true,backgroundColor:'#0a0a12',logging:false});el.slide.style.transform=ot;const a=document.createElement('a');a.download=`${el.charName.value||'character'}_${el.evolution.value}.png`;a.href=cv.toDataURL('image/png');document.body.appendChild(a);a.click();document.body.removeChild(a)}catch(e){console.error(e);alert('エクスポートに失敗しました: '+e.message)}load(0)}
function getData(){const abs=[];for(let i=0;i<8;i++)abs.push({val:$('ab'+i).value,type:abTypes[i]});return{charName:el.charName.value,evolution:el.evolution.value,attribute:el.attribute.value,shotType:el.shotType.value,battleType:el.battleType.value,race:el.race.value,abilities:abs,connect1:el.connect1.value,connect2:el.connect2.value,connect3:el.connect3.value,shotSkill:el.shotSkill.value,assistSkill:el.assistSkill.value,ssName:el.ssName.value,ssTurn:el.ssTurn.value,ssEffect:el.ssEffect.value,friendship:el.friendship.value,subFriendship:el.subFriendship.value,imageData:img,imgSettings:{...imgSettings}}}
function setData(d){Object.keys(d).forEach(k=>{if(k==='imageData'){img=d[k];if(img){el.uploadPlaceholder.innerHTML=`<img src="${img}">`;el.imageUploadArea.classList.add('has-image');el.imageControls.style.display='block'}}else if(k==='imgSettings'&&d[k]){imgSettings={...d[k]};el.imgScale.value=imgSettings.scale;el.imgX.value=imgSettings.x;el.imgY.value=imgSettings.y;el.imgScaleVal.textContent=imgSettings.scale+'%';el.imgXVal.textContent=imgSettings.x;el.imgYVal.textContent=imgSettings.y}else if(k==='abilities'&&d[k]){d[k].forEach((ab,i)=>{$('ab'+i).value=ab.val||'';abTypes[i]=ab.type||0;const btn=document.querySelector(`.ability-toggle[data-idx="${i}"]`);btn.className=`ability-toggle ${abTypes[i]===0?'badge-ability':'badge-gauge'}`;btn.textContent=abTypes[i]===0?'アビ':'ゲージ'})}else if(el[k])el[k].value=d[k]||''});vis();upd()}
async function save(){const d=getData();if(!d.charName){alert('キャラクター名を入力してください');return}load(1);try{const ot=el.slide.style.transform;el.slide.style.transform='none';const cv=await html2canvas(el.slide,{width:1920,height:1080,scale:.2,useCORS:true,allowTaint:true,backgroundColor:'#0a0a12',logging:false});el.slide.style.transform=ot;const th=cv.toDataURL('image/jpeg',.7);let h=JSON.parse(localStorage.getItem('monstSlideHistory')||'[]');const en={id:editId||Date.now().toString(),data:d,thumbnail:th,createdAt:editId?h.find(x=>x.id===editId)?.createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(editId){const i=h.findIndex(x=>x.id===editId);if(i!==-1)h[i]=en;editId=null}else h.unshift(en);h=h.slice(0,50);localStorage.setItem('monstSlideHistory',JSON.stringify(h));hist();alert('保存しました')}catch(e){console.error(e);alert('保存に失敗しました: '+e.message)}load(0)}
function hist(){const h=JSON.parse(localStorage.getItem('monstSlideHistory')||'[]');if(!h.length){el.historyList.innerHTML='<div class="empty-history">保存されたスライドはありません</div>';return}el.historyList.innerHTML=h.map(i=>`<div class="history-item"><img class="history-thumbnail" src="${i.thumbnail}"><div class="history-info"><div class="history-name">${i.data.charName}</div><div class="history-meta"><span>${i.data.evolution}</span><span>${new Date(i.updatedAt).toLocaleDateString('ja-JP')}</span></div></div><div class="history-actions"><button class="history-btn history-btn-edit" onclick="lf('${i.id}')">編集</button><button class="history-btn history-btn-delete" onclick="df('${i.id}')">削除</button></div></div>`).join('')}
window.lf=id=>{const h=JSON.parse(localStorage.getItem('monstSlideHistory')||'[]'),i=h.find(x=>x.id===id);if(i){editId=id;setData(i.data);tab('editor')}};
window.df=id=>{if(!confirm('このスライドを削除しますか？'))return;let h=JSON.parse(localStorage.getItem('monstSlideHistory')||'[]');h=h.filter(x=>x.id!==id);localStorage.setItem('monstSlideHistory',JSON.stringify(h));hist()};
function tab(t){document.querySelectorAll('.nav-tab').forEach(x=>x.classList.remove('active'));document.querySelector(`[data-tab="${t}"]`).classList.add('active');if(t==='editor'){el.editorPanel.style.display='block';el.previewPanel.style.display='flex';el.historyPanel.classList.remove('active')}else{el.editorPanel.style.display='none';el.previewPanel.style.display='none';el.historyPanel.classList.add('active')}}
function load(s){el.loadingOverlay.classList.toggle('active',s)}
vis();upd();hist();
</script>
</body>
</html>
